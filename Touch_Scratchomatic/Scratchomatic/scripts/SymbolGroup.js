SymbolGroup=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=pgc.Game.ScratchController.getTextureMultiplier(),v=[],w=[!0,!0],x=!1,y=a.fitMode||pgc.CanvasFitModes.SCALE,z=a.unifiedScaling===!0,A=a.disableScratch===!0,B=a.disableInput===!0,C=a.fillEmpty===!0,D=this,E=a.container,F=(a.width||100)*u,G=(a.height||100)*u,H=(a.gutter||0)*u,I=[],J=null,K=[],L=500,M=[],N=[],O=[],P=[],Q=0,R=[],S=[],T=[],U=[],V=0,W=[],X=0,Y=[],Z=[],$=function(a){return"string"==typeof a?ip.getPreloadedImage(a):a},_=function(a,b){for(var c=Object.keys(a),d={},e=0;e<c.length;e++)d[c[e]]="undefined"!=typeof b[c[e]]?b[c[e]]:a[c[e]];return d},aa=function(){var a,b=[];for(a=0;a<O.length;a++)b.push(O[a]);for(O=[],a=0;a<N.length;a++)c.removeFromScene(b[a]),M[a]?M[a].modify(N[a]):(N[a].location=E,M[a]=new CanvasText(N[a])),O[a]=new PGCImage(M[a].createTextImage(N[a].string)),O[a].x=N[a].offsetX||0,O[a].y=N[a].offsetY||0,O[a].anchor=N[a].anchor||PGCAnchors.TOP_LEFT,O[a].x+=H,O[a].y+=H,c.addToScene(O[a],N[a].zIndex)},ba=function(){if(!(Z.length<=1)){var a,b,c,d,e=Z[pgc.Game.chosenTheme-1],f=Z[0];if(e.title){for(N=[_(f.title[0],e.title[0])],a=1;a<e.title.length;a++)c=_(f.title[0],e.title[0]),N.push(c);aa()}if(e.background)for(P=[_(f.background[0],e.background[0])],a=1;a<e.background.length;a++)c=_(f.background[a],e.background[a]),P.push(c);if(e.value&&(h=_(f.value,e.value),g?g.modify(h):(h.location=E,g=new CanvasText(h))),e.prize&&(l=_(f.prize,e.prize),k?k.modify(l):(l.location=E,k=new CanvasText(l))),e.foil)for(U=[_(f.foil[0],e.foil[0])],a=1;a<e.foil.length;a++)c=_(f.foil[a],e.foil[a]),U.push(c);if(e.foilAnim&&(s=e.foilAnim,s.setGlobalCompositeOperation("source-in")),e.scratchSprite)for(W=[_(f.scratchSprite[0],e.scratchSprite[0])],a=1;a<e.scratchSprite.length;a++)c=_(f.scratchSprite[a],e.scratchSprite[a]),W.push(c);if(e.prizeSymbol&&(e.prizeSymbol.prize&&(p.prize=_(f.prizeSymbol.prize,e.prizeSymbol.prize)),e.prizeSymbol.foil&&(p.foil=_(f.prizeSymbol.foil,e.prizeSymbol.foil)),e.prizeSymbol.scratchSprite&&(p.scratchSprite=_(f.prizeSymbol.scratchSprite,e.prizeSymbol.scratchSprite))),e.specials)for(R=[],S=[],c=[],a=0;a<f.specials.length;a++){for(d=!1,b=0;b<e.specials.length;b++)if(f.specials[a].nameVal===e.specials[b].nameVal){d=!0;break}c=d?_(f.specials[b],e.specials[a]):f.specials[a],R.push(c),S.push(c.values?c.values:null)}}},ca=function(a,b,c,d,e){var f,s;d&&(d=String(d)),c&&(c=String(c));var v,w,x,y,z,A,B,C,E=[];if(P.length>0&&(P[Q].frames?(v=new PGCSprite($(P[Q].source),a,b,P[Q].sampleX,P[Q].sampleY,P[Q].sampleWidth,P[Q].sampleHeight),v.setFrames(P[Q].frames,P[Q].frameRate)):v=new PGCImage($(P[Q].source),a,b,P[Q].sampleX,P[Q].sampleY,P[Q].sampleWidth,P[Q].sampleHeight),Q++,Q%=P.length,P[Q].startingScale&&v.setScaling(P[Q].startingScale),v.anchor=PGCAnchors.CENTRE),e){if(!o||!c)throw new Error("Attempt to create prize symbol without specifying prize value!");x=new PGCImage(o.createTextImage(c),a+q,b+r),x.anchor=PGCAnchors.CENTRE,p.prize.maxWidth&&x.width>p.prize.maxWidth&&x.setScaling(p.prize.maxWidth/x.width)}else g&&d&&(w=new PGCImage(g.createTextImage(d),a+i,b+j),w.anchor=PGCAnchors.CENTRE,h.maxWidth&&w.width>h.maxWidth&&w.setScaling(h.maxWidth/w.width)),k&&c&&(x=new PGCImage(k.createTextImage(c),a+m,b+n),x.anchor=PGCAnchors.CENTRE,l.maxWidth&&x.width>l.maxWidth&&x.setScaling(l.maxWidth/x.width));if(R.length>0)for(f=0;f<S.length;f++)if(null===S[f]||S[f].indexOf(d)>-1){if(R[f].strings){for(C=null,s=0;s<R[f].strings.length;s++)if(!R[f].strings[s].value||R[f].strings[s].value===d){C=new PGCImage(R[f].createTextImage(R[f].strings[s].string),a+R[f].offsetX,b+R[f].offsetY);break}if(!C)continue}else R[f].frames?(C=new PGCSprite($(R[f].source),a+R[f].offsetX,b+R[f].offsetY,R[f].sampleX,R[f].sampleY,R[f].sampleWidth,R[f].sampleHeight),C.setFrames(R[f].frames,R[f].frameRate)):C=new PGCImage($(R[f].source),a+R[f].offsetX,b+R[f].offsetY,R[f].sampleX,R[f].sampleY,R[f].sampleWidth,R[f].sampleHeight);C.setScaling(R[f].startingScale),C.anchor=PGCAnchors.CENTRE,C.zIndex=R[f].zIndex,C.nameVal=R[f].nameVal,C.visible=R[f].visible,C.cropToFoil=R[f].cropToFoil,E.push(C),w&&R[f].hideValue&&(w.visible=!1),x&&R[f].hidePrize&&(x.visible=!1)}e&&p.foil?(z=document.createElement("canvas"),A=z.getContext("2d"),z.width=p.foil.sampleWidth,z.height=p.foil.sampleHeight,A.clearRect(0,0,z.width,z.height),A.drawImage($(p.foil.source),p.foil.sampleX,p.foil.sampleY,p.foil.sampleWidth,p.foil.sampleHeight,0,0,z.width,z.height)):U.length>0&&(z=document.createElement("canvas"),A=z.getContext("2d"),z.width=U[V].sampleWidth,z.height=U[V].sampleHeight,A.clearRect(0,0,z.width,z.height),A.drawImage($(U[V].source),U[V].sampleX,U[V].sampleY,U[V].sampleWidth,U[V].sampleHeight,0,0,z.width,z.height),V++,V%=U.length),U[V]&&U[V].frames?(y=new PGCSprite(z,a,b),y.setFrames(U[V].frames,U[V].frameRate)):y=new PGCImage(z,a,b),y.opacity=U.foilOpacity,y.anchor=PGCAnchors.CENTRE,e&&p.scratchSprite?(B=new PGCSprite($(p.scratchSprite.source),0,0,p.scratchSprite.sampleX,p.scratchSprite.sampleY,p.scratchSprite.sampleWidth,p.scratchSprite.sampleHeight),B.setFrames(p.scratchSprite.frames,p.scratchSprite.frameRate),B.globalCompositeOperation="destination-out"):W.length>0&&(B=new PGCSprite($(W[X].source),0,0,W[X].sampleX,W[X].sampleY,W[X].sampleWidth,W[X].sampleHeight),B.setFrames(W[X].frames,W[X].frameRate),B.globalCompositeOperation="destination-out",X++,X%=W.length);var F;if(Y.length>0)for(f=0;f<Y.length;f++)(!Y[f].values||Y[f].values.indexOf(d)>-1)&&(F=Y[f]);if(!F&&U.length>0){var G,H,I;if(e&&p.foil&&p.foil.scratchArea?I=p.foil.scratchArea:U[V].scratchArea&&(I=U[V].scratchArea),I){switch(U[V].scratchArea){case"Value":case"value":G=w.spriteImage?w.spriteWidth:w.width,H=w.spriteImage?w.spriteHeight:w.height;break;case"Prize":case"prize":G=x.spriteImage?x.spriteWidth:x.width,H=x.spriteImage?x.spriteHeight:x.height;break;default:G=z.width,H=z.height}F={offsetX:-i-G/2,offsetY:j-H/2,w:G,h:H}}}var J=new Symbol({group:D,x:a,y:b,backgroundObj:v,value:d,valueObj:w,prize:c,prizeObj:x,specialObjs:E,foilImage:y,foilContext:A,scratchSprite:B,scratchBBox:F,texMult:u,prizeSymbol:e});return t&&J.setTouchBBox(t.offsetX,t.offsetY,t.w,t.h),J},da=function(){var a,b,f,g;switch(y){case pgc.CanvasFitModes.SCALE:a=parseInt(getComputedStyle(E).width,10),b=parseInt(getComputedStyle(E).height,10),f=parseInt(c.canvas.style.width,10)-e,g=parseInt(c.canvas.style.height,10)-e,(f!==a||g!==b)&&(e=parseInt(getComputedStyle(E).width,10)/F*d,c.canvas.style.width=a+e+"px",c.canvas.style.height=b+e+"px",c.canvas.style.marginLeft=-(e/2)+"px",c.canvas.style.marginTop=-(e/2)+"px",c.context.clearRect(0,0,1,1));break;case pgc.CanvasFitModes.RESIZE:a=parseInt(getComputedStyle(E).width,10),b=parseInt(getComputedStyle(E).height,10),f=c.canvas.width-d,g=c.canvas.height-d,(f!==a||g!==b)&&(c.canvas.width=a+d,c.canvas.height=b+d,c.canvas.style.marginLeft=-H+"px",c.canvas.style.marginTop=-H+"px"),D.requestDraw()}};this.getDisableScratch=function(){return A===!0},this.setDisableScratch=function(a){A=a===!0},this.getDisableInput=function(){return B===!0},this.setDisableInput=function(a){B=a===!0},this.getWidth=function(){return c.canvas.width/u},this.getHeight=function(){return c.canvas.height/u},this.setTitleConfig=function(a){var b=pgc.Game.ScratchController.multiplyConfig(a);return b.offsetX=b.offsetX||0,b.offsetY=b.offsetY||0,b.zIndex=b.zIndex||SymbolZIndices.BACKGROUND+1,b.nameVal=b.nameVal||"default",N=[b],M=[],aa(),w=[!0,!0],this},this.setTitleString=function(a){if("string"!=typeof a.string)throw new Error("Call to setTitleString without providing a new string");for(var b=a.nameVal||"default",c=0;c<N.length;c++)if(N[c].nameVal===b){N[c].string=a.string;break}return aa(),w=[!0,!0],this},this.setBackgroundConfig=function(a){return P=[pgc.Game.ScratchController.multiplyConfig(a)],this},this.setValueConfig=function(a){return h=pgc.Game.ScratchController.multiplyConfig(a),i=h.offsetX||0,j=h.offsetY||0,g?g.modify(h):(h.location=E,g=new CanvasText(h)),this},this.getValueConfig=function(){for(var a={offsetX:h.offsetX?h.offsetX/u:void 0,offsetY:h.offsetY?h.offsetY/u:void 0,fontFamily:h.fontFamily,fontSize:h.fontSize?parseFloat(h.fontSize)/u+h.fontSize.match(/[^\d\.]*$/)[0]:void 0,fontStyle:h.fontStyle,fontWeight:h.fontWeight,fontVariant:h.fontVariant,fillStyle:h.fillStyle,shadowColour:h.shadowColour,shadowBlur:h.shadowBlur,shadowOffsetX:h.shadowOffsetX?h.shadowOffsetX/u:void 0,shadowOffsetY:h.shadowOffsetY?h.shadowOffsetY/u:void 0},b=[],c=[],d=0;d<h.strokeStyles.length;d++)b.push(h.strokeStyles[d]),c.push(parseFloat(h.lineWidths[d])/u+String(h.lineWidths[d]).match(/[^\d\.]*$/)[0]);return a.strokeStyles=b,a.lineWidths=c,a},this.getValueFactory=function(){return g.clone()},this.setPrizeConfig=function(a){return l=pgc.Game.ScratchController.multiplyConfig(a),m=l.offsetX||0,n=l.offsetY||0,k?k.modify(l):(l.location=E,k=new CanvasText(l)),this},this.getPrizeConfig=function(){for(var a={offsetX:l.offsetX?l.offsetX/u:void 0,offsetY:l.offsetY?l.offsetY/u:void 0,fontFamily:l.fontFamily,fontSize:l.fontSize?parseFloat(l.fontSize)/u+l.fontSize.match(/[^\d\.]*$/)[0]:void 0,fontStyle:l.fontStyle,fontWeight:l.fontWeight,fontVariant:l.fontVariant,fillStyle:l.fillStyle,shadowColour:l.shadowColour,shadowBlur:l.shadowBlur,shadowOffsetX:l.shadowOffsetX?l.shadowOffsetX/u:void 0,shadowOffsetY:l.shadowOffsetY?l.shadowOffsetY/u:void 0},b=[],c=[],d=0;d<l.strokeStyles.length;d++)b.push(l.strokeStyles[d]),c.push(parseFloat(l.lineWidths[d])/u+String(l.lineWidths[d]).match(/[^\d\.]*$/)[0]);return a.strokeStyles=b,a.lineWidths=c,a},this.getPrizeFactory=function(){return k.clone()},this.getPrizeSymbolPrizeFactory=function(){return o.clone()},this.setPrizeSymbolConfig=function(a){return p={},a.prize&&(p.prize=pgc.Game.ScratchController.multiplyConfig(a.prize),q=p.prize.offsetX||0,r=p.prize.offsetY||0,o?o.modify(p.prize):(p.location=E,o=new CanvasText(p.prize))),a.foil&&(p.foil=pgc.Game.ScratchController.multiplyConfig(a.foil)),a.scratchSprite&&(p.scratchSprite=pgc.Game.ScratchController.multiplyConfig(a.scratchSprite)),this},this.setFoilConfig=function(a){return U=[],U[0]=pgc.Game.ScratchController.multiplyConfig(a),this},this.setScratchSpriteConfig=function(a){return W=[],W[0]=pgc.Game.ScratchController.multiplyConfig(a),this},this.setSymbolTouchBBox=function(a){t=pgc.Game.ScratchController.multiplyConfig(a)},this.setFoilAnimation=function(a){return s=a,s&&s.setGlobalCompositeOperation("source-in"),this},this.getGroupSize=function(){return b.length},this.getSymbols=function(a){for(var b=[],c=a&&a.start?a.start:0,d=a&&a.length?a.length:v.length,e=c;c+d>e;e++)b.push(v[e]);return b},this.clearSymbols=function(){for(var a=0;a<v.length;a++)v[a].removeSelfFromScene();return v=[],I=[],x=!1,this},this.setSymbols=function(a,d){if(C&&a.length<b.length)for(o=a.length;o<b.length;o++)a.push({value:void 0,prize:void 0});d=d||0;var e,f,g,i=0;for(ba(),f=d,e=0;e<a.length;e++){if(a[e]||(a[e]={value:void 0,prize:void 0}),b[f].isPrizeSymbol){if(!a[e-1])throw new Error("Attempted to create a prizeSymbol before creating a normal symbol!");g=ca(b[f].x,b[f].y,a[e-1].prize,"PRIZE_SYMBOL",!0),i++,v[f]&&v[f].removeSelfFromScene(),v[f]=g,I.push(null),g.addSelfToScene(c),f++}if(a[e].value&&String(a[e].value).indexOf(pgc.ScratchConstants.MULTI_SYMBOL_DELIMITER)>0){var j,k=a[e].value.split(pgc.ScratchConstants.MULTI_SYMBOL_DELIMITER);for(j=0;j<k.length;j++)g=ca(b[f].x,b[f].y,a[e].prize,k[j]),i++,v[f]&&v[f].removeSelfFromScene(),v[f]=g,I.push(null),g.addSelfToScene(c),f++}else g=ca(b[f].x,b[f].y,a[e].prize,a[e].value),i++,v[f]&&v[f].removeSelfFromScene(),v[f]=g,I.push(null),g.addSelfToScene(c),f++}if(b[f]&&b[f].isPrizeSymbol){if(!a[e-1])throw new Error("Attempted to create a prizeSymbol before creating a normal symbol!");g=ca(b[f].x,b[f].y,a[e-1].prize,"PRIZE_SYMBOL",!0),i++,v[f]&&v[f].removeSelfFromScene(),v[f]=g,I.push(null),g.addSelfToScene(c)}if(z){var m,n,o,p=1/0,q=1/0;for(o=0;o<v.length;o++)h&&(m=v[o].getValueObj().scalingFactor,p=p>m?m:p),l&&(n=v[o].getPrizeObj().scalingFactor,q=q>n?n:q);for(o=0;o<v.length;o++)h&&v[o].getValueObj().setScaling(p),l&&v[o].getPrizeObj().setScaling(q)}return w=[!0,!0],i},this.setSymbolPositions=function(a){b=[];for(var c=0;c<a.length;c++)b.push({x:a[c].x*u+H,y:a[c].y*u+H,isPrizeSymbol:a[c].isPrizeSymbol===!0});return this},this.getScene=function(){return c},this.getMaxAnimationDuration=function(){return L},this.getGroupSpriteByName=function(a){for(var b=0;b<K.length;b++)if(K[b].nameVal===a)return K[b];throw new Error("Group sprite: '"+a+"' does not exist!")},this.setScratchArea=function(a){if(!(a.offsetX&&a.offsetY&&a.w&&a.h))throw new Error("Missing config on custom scratch area!");return Y=[a],this},this.setTimeLine=function(a){f=a,f.start()},this.unsetTimeLine=function(){f.stop(),f=null},this.addBackgroundConfig=function(a){var b=pgc.Game.ScratchController.multiplyConfig(a);return b=b||{},b.source=b.source||P[0].source,b.sampleX=b.sampleX||P[0].sampleX,b.sampleY=b.sampleY||P[0].sampleY,b.sampleWidth=b.sampleWidth||P[0].sampleWidth,b.sampleHeight=b.sampleHeight||P[0].sampleHeight,b.frames=b.frames||P[0].frames,b.frameRate=b.frameRate||P[0].frameRate,b.startingScale=b.startingScale||P[0].startingScale,P.push(b),this},this.addFoilConfig=function(a){var b=pgc.Game.ScratchController.multiplyConfig(a);return b=b||{},b.source=b.source||U[0].source,b.sampleX=b.sampleX||U[0].sampleX,b.sampleY=b.sampleY||U[0].sampleY,b.sampleWidth=b.sampleWidth||U[0].sampleWidth,b.sampleHeight=b.sampleHeight||U[0].sampleHeight,b.frames=b.frames||U[0].frames,b.frameRate=b.frameRate||U[0].frameRate,b.scratchArea=b.scratchArea||U[0].scratchArea,b.foilOpacity=b.foilOpacity||U[0].foilOpacity,U.push(b),this},this.addScratchSpriteConfig=function(a){var b=pgc.Game.ScratchController.multiplyConfig(a);return b=b||{},b.source=b.source||W[0].source,b.sampleX=b.sampleX||W[0].sampleX,b.sampleY=b.sampleY||W[0].sampleY,b.sampleWidth=b.sampleWidth||W[0].sampleWidth,b.sampleHeight=b.sampleHeight||W[0].sampleHeight,b.frames=b.frames||W[0].frames,b.frameRate=b.frameRate||W[0].frameRate,W.push(b),this},this.addSpecialConfig=function(a){a=a||{};var b=pgc.Game.ScratchController.multiplyConfig(a);b.nameVal=b.nameVal||"default",b.hideValue=b.hideValue||!1,b.hidePrize=b.hidePrize||!1,b.visible=b.visible!==!1,b.zIndex=b.zIndex||SymbolZIndices.SPRITE,b.startingScale=b.startingScale||1,b.offsetX=b.offsetX||0,b.offsetY=b.offsetY||0;for(var c=0;c<R.length;c++)if(R[c].nameVal===b.nameVal)throw new Error("Special config nameVal: '"+b.nameVal+"' is not unique! All specials must have a unique name.");return S.push(b.values?b.values:null),R.push(b),this},this.addSpecialTextConfig=function(a){a.location=E;var b=new CanvasText(pgc.Game.ScratchController.multiplyConfig(a));if(b.values=a.values,b.nameVal=a.nameVal,b.hideValue=a.hideValue||!1,b.hidePrize=a.hidePrize||!1,b.visible=a.visible!==!1,b.zIndex=a.zIndex||SymbolZIndices.SPRITE,b.startingScale=b.startingScale||1,b.offsetX=a.offsetX||0,b.offsetY=a.offsetY||0,b.strings=a.strings,!b.nameVal)throw new Error("Special text config must have a unique nameVal!");for(var c=0;c<R.length;c++)if(R[c].nameVal===b.nameVal)throw new Error("Special config nameVal: '"+b.nameVal+"' is not unique! All specials must have a unique name.");if(!b.strings)throw new Error("Special text config nameVal: '"+b.nameVal+"' is never used! At least one string must be specified for a special text config to be usable.");return S.push(b.values?b.values:null),R.push(b),this},this.addScratchArea=function(a){if(!(a.values&&a.offsetX&&a.offsetY&&a.w&&a.h))throw new Error("Missing config on custom scratch area!");return Y.push(a),this},this.addAnimation=function(a){if(!a.triggerCondition)throw new Error("Must supply trigger condition from pgc.ScratchAnimationTriggers!");return a.values=a.values||[],a.priority=a.priority||pgc.Priorities.NORMAL,T.push(a),a.duration&&L<a.duration&&(L=a.duration),this},this.addTitleConfig=function(a){var b=pgc.Game.ScratchController.multiplyConfig(a);b.offsetX=b.offsetX||0,b.offsetY=b.offsetY||0,b.zIndex=b.zIndex||SymbolZIndices.BACKGROUND+1;for(var c=0;c<N.length;c++)if(N[c].nameVal===b.nameVal)throw new Error("Title config nameVal: '"+b.nameVal+"' is not unique! All titles must have a unique name.");return N.push(b),aa(),w=[!0,!0],this},this.addGroupSprite=function(a){a=a||{};var b,d=pgc.Game.ScratchController.multiplyConfig(a);return d.offsetX=d.offsetX||0,d.offsetY=d.offsetY||0,d.startingScale=d.startingScale||1,d.frames?(b=new PGCSprite($(d.source),d.offsetX,d.offsetY,d.sampleX,d.sampleY,d.sampleWidth,d.sampleHeight),b.setFrames(d.frames,d.frameRate)):b=new PGCImage($(d.source),d.offsetX,d.offsetY,d.sampleX,d.sampleY,d.sampleWidth,d.sampleHeight),b.anchor=d.anchor||PGCAnchors.TOP_LEFT,b.visible=d.visible!==!1,b.zIndex=d.zIndex||SymbolZIndices.POP_OVER,b.nameVal=d.nameVal,b.setScaling(d.startingScale),K.push(b),c.addToScene(b,b.zIndex),this},this.addSkin=function(a){var b,c,d;for(0===Z.length&&Z.push({title:N,background:P,value:h,prize:l,foil:U,foilAnim:s,scratchSprite:W,specials:R}),c=Z.length,Z.push({}),a.title&&(Z[c].title=[pgc.Game.ScratchController.multiplyConfig(a.title)]),a.background&&(Z[c].background=[pgc.Game.ScratchController.multiplyConfig(a.background)]),a.value&&(Z[c].value=pgc.Game.ScratchController.multiplyConfig(a.value)),a.prize&&(Z[c].prize=pgc.Game.ScratchController.multiplyConfig(a.prize)),a.foil&&(Z[c].foil=[pgc.Game.ScratchController.multiplyConfig(a.foil)]),a.foilAnim&&(Z[c].foilAnim=a.foilAnim),a.scratchSprite&&(Z[c].scratchSprite=[pgc.Game.ScratchController.multiplyConfig(a.scratchSprite)]),a.prizeSymbol&&(Z[c].prizeSymbol={},a.prizeSymbol.prize&&(Z[c].prizeSymbol.prize=pgc.Game.ScratchController.multiplyConfig(a.prizeSymbol.prize)),a.prizeSymbol.foil&&(Z[c].prizeSymbol.foil=pgc.Game.ScratchController.multiplyConfig(a.prizeSymbol.foil)),a.prizeSymbol.scratchSprite&&(Z[c].prizeSymbol.scratchSprite=pgc.Game.ScratchController.multiplyConfig(a.prizeSymbol.scratchSprite))),b=1;b<arguments.length;b++)d=arguments[b],d.altTitle&&(Z[c].title||(Z[c].title=Z[0].title.slice(0,1)),Z[c].title.push(pgc.Game.ScratchController.multiplyConfig(d.altTitle))),d.altBackground&&(Z[c].background||(Z[c].background=Z[0].background.slice(0,1)),Z[c].background.push(pgc.Game.ScratchController.multiplyConfig(d.altBackground))),d.altFoil&&(Z[c].foil||(Z[c].foil=Z[0].foil.slice(0,1)),Z[c].foil.push(pgc.Game.ScratchController.multiplyConfig(d.altFoil))),d.altScratchSprite&&(Z[c].scratchSprite||(Z[c].scratchSprite=Z[0].scratchSprite.slice(0,1)),Z[c].scratchSprite.push(pgc.Game.ScratchController.multiplyConfig(d.altScratchSprite))),d.special&&(Z[c].specials||(Z[c].specials=[]),Z[c].specials.push(pgc.Game.ScratchController.multiplyConfig(d.special))),d.specialText&&(Z[c].specials||(Z[c].specials=[]),Z[c].specials.push(pgc.Game.ScratchController.multiplyConfig(d.specialText)));return this},this.animateGroupSprite=function(a){if(!a.spriteName)throw new Error("spriteName must be specified in animation functions!");a.count=a.count||1,a.visibleAfter=a.visibleAfter!==!1;var b=D.getGroupSpriteByName(a.spriteName);if(b.visible=!0,!b.frames)throw new Error("Trying to animate non-animated group sprite!");a.x&&(b.x=a.x*u),a.y&&(b.y=a.y*u);var c=a.visibleAfter,d=a.count;b.run(function(){b.visible=c,D.requestDraw()},d,0)},this.triggerAnimation=function(a){var b,c,d,e=[],f=[],g=!1;if(!a.trigger)throw new Error("Call to trigger animation with no trigger provided!");for(b=0;b<T.length;b++)if(T[b].triggerCondition===a.trigger&&(T[b].timeLine&&e.push(T[b]),T[b].groupTimeLine))if(null===J||J.priority<T[b].priority)J=T[b],g=!0;else if(J!==T[b])throw new Error("Attempt to trigger two animations with same priority!\n\nSymbol:\n"+v[d].toString()+"\n\nAnimation already triggered:\n"+I[d].groupTimeLine.toString()+"\n\nAnimation being triggered:\n"+e[c].groupTimeLine.toString());if(a.symbols)for(b=0;b<a.symbols.length;b++)v.indexOf(a.symbols[b])>-1&&f.push(a.symbols[b]);else f=v;for(b=0;b<f.length;b++)for(c=0;c<e.length;c++)if(0===e[c].values.length||e[c].values.indexOf(f[b].getValue())>-1)if(d=v.indexOf(f[b]),null===I[d]||I[d].priority<e[c].priority)I[d]=e[c],g=!0;else if(I[d].priority===e[c].priority&&I[d]!==e[c])throw new Error("Attempt to trigger two animations with same priority!\n\nSymbol:\n"+v[d].toString()+"\n\nAnimation already triggered:\n"+I[d].timeLine.toString()+"\n\nAnimation being triggered:\n"+e[c].timeLine.toString());return g},this.tapReveal=function(a,b){if(A)return null;var c;for(c=0;c<v.length;c++){var d=v[c].getTouchBBox();if(a>=d.x&&a<=d.x+d.w&&b>=d.y&&b<=d.y+d.h){if(!v[c].getScratched()&&!v[c].getScratchAnimating()){v[c].setScratchAnimating(!0);var e=D.triggerAnimation({trigger:pgc.ScratchAnimationTriggers.TAP_INTERRUPT,symbols:[v[c]]});return e||v[c].animateScratch(),c}break}}return null},this.revealAll=function(){var a;for(a=0;a<v.length;a++)if(!v[a].getScratched()&&!v[a].getScratchAnimating()){v[a].setScratchAnimating(!0);var b=D.triggerAnimation({trigger:pgc.ScratchAnimationTriggers.TAP_INTERRUPT,symbols:[v[a]]});b||v[a].animateScratch()}},this.scratch=function(a,b,c){if(!A)for(var d=new PGCRect(b-a.width/2,c-a.height/2,b+a.width/2,c+a.height/2),e=0;e<v.length;e++)d.collides(v[e].getFoilRect())&&v[e].scratch(a,d,b,c)},this.allScratched=function(){if(x)return!0;for(var a=0,b=0;b<v.length;b++)v[b].getScratched()&&a++;return a===v.length?(x=!0,D.triggerAnimation({trigger:pgc.ScratchAnimationTriggers.ALL_SCRATCHED}),!0):void 0},this.save=function(){for(var a=[],b=0;b<v.length;b++)v[b].getScratched()&&a.push(b);return JSON.stringify(a)},this.load=function(a){var b=a&&JSON.parse(a),c=A;A=!1;for(var d=0;d<b.length;d++)if(b[d]<v.length&&b[d]>=0){var e=parseInt(b[d]);if(!isNaN(e)&&e>=0){v[d].setScratchAnimating(!0);var f=D.triggerAnimation({trigger:pgc.ScratchAnimationTriggers.TAP_INTERRUPT,symbols:[v[d]]});f||v[d].animateScratch()}}A=c},this.requestDraw=function(){w=[!0,!0]},this.step=function(){da();var a,b,d;for(d=(new Date).getTime(),b=d-c.lastUpdate,a=0;a<v.length;a++)v[a].step(b);for(a=0;a<I.length;a++)null!==I[a]&&(v[a].setTimeLine(I[a].timeLine.clone(v[a])),w=[!0,!0],I[a]=null);for(null!==J&&(D.setTimeLine(J.groupTimeLine.setTarget(D)),J=null),f&&f.step(b),a=0;a<c.children.length;a++)if(c.children[a].requestUpdate||c.children[a].runFrameAnimation){w=[!0,!0];break}w[0]||w[1]?D.render(b):c.lastUpdate=d},this.render=function(a){c.context.save(),c.lastUpdate=Date.now()-a,c.update(),w[0]=w[1],w[1]=!1,c.context.restore()},d=2*H,e=E?parseInt(getComputedStyle(E).width,10)/F*d:d,c=new PGCScene(F+d,G+d,E),pgc.Game.scratchSceneReferences.push(c),pgc.Game.symbolGroupReferences.push(this),da()};