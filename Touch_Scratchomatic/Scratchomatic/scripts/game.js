var pgc=window.pgc||{};!function(a,b){var c,d,e,f,g,h=new b.EventDispatcher,i=!1,j={main:"",ambient:""},k=!1,l=!1,m=-1,n=!1,o=-1,p=!1,q=!1,r=!1,s=500;a.ready=function(){return function(a){h.addEventListener("ready",a)}}(),a.scratchtoolchanged=function(){return function(a){h.addEventListener("scratchtoolchanged",a)}}(),a.idle=function(){return function(a,b){b?h.addEventListener("repeatedidle",function(c){(0===c||c%b>=b-s)&&a()}):h.addEventListener("idle",a)}}(),a.idlefinish=function(){return function(a){h.addEventListener("idlefinish",a)}}(),a.lastintroanimation=function(){return function(a){h.addEventListener("lastintroanimation",a)}}(),a.heartbeat=function(){return function(a){h.addEventListener("heartbeat",a)}}(),a.updateBank=function(a){var b=document.getElementById("user-balance"),c=getLocalisedString("toolbar.bankTitle")+" "+this.multiCurrencyManager.formatAmount(a,!0,!0,1);-1===c.indexOf(",-")&&(c+=",-"),b.innerHTML="<p>"+c+"</p>"},a.updatePriceLabel=function(b){var c=document.getElementById("price-label");b=parseInt(b,10),c&&!isNaN(b)&&b>0||a.defaultPrice>0&&(b=a.defaultPrice),c.innerHTML=pgc.Game.multiCurrencyManager.formatAmount(b,!1,!0,1)+",-"},a.trigger=function(a){Array.prototype.slice.call(arguments,1);h.dispatch.apply(h,arguments)},a.initAudio=function(){if(a.audio||(a.audio={}),a.audio.names={intro:"intro",main:"main",buy:"buy",cardSelection:"cardSelection",match:"match",win:"win",ambience:"ambience",fallback_ambience:"fallback_ambience",button:"button",scratching:"scratching",instant:"instant",instantScratch:"instantScratch",scratchAll_button:"scratchAll_button",scratchAll:"scratchAll",lose:"lose",control:"control",close:"close"},c=new AudioController,c.init(),"iPhone Simulator"===navigator.platform&&c.webAudioFeatureOverride(!0),"object"==typeof a.audio&&a.audio.audioEnabled){if(a.audio.variedAudio?c.setupVariedAudioFromConfig(a.audio,!1,!1):c.setupAudioFromConfig(a.audio,!1,!1),c.version<=1&&("ontouchstart"in window?i=!0:c.getAudioSprite(pgc.Game.ScratchController.skinSelect(a.audio.names.main)).preloadSound(function(){})),g=document.getElementById("sound-button"),DOMUtil.appendClassName(g,"","hidden"),pgc.Game.UserData){var b=pgc.Game.UserData.getUserData(gameName+"-audioEnabled");null===b?(b=!0,pgc.Game.UserData.setUserData(gameName+"-audioEnabled",b)):b="true"===b?!0:!1,c.toggleSound(b),b?DOMUtil.appendClassName(g,"","soundOff"):DOMUtil.appendClassName(g,"soundOff","")}else c.toggleSound(!0);g.addEventListener(DOMUtil.touchEvent,pgc.Game.toggleSound),f=a.audio.loopAmbience||!1}},a.readyWait=function(b,c,d){b()?c():setTimeout(function(){a.readyWait(b,c,d)},d)},a.getAudioEngine=function(){return c},a.getAudioResourceURL=function(){var a=AudioController.prototype.isExtensionSupported,b="m4a";return a&&!a(b)&&(b="ogg"),imageHostName+"/lib/Games/"+gameName+"/sounds/sounds."+b},a.isAmbiencePlaying=function(){return k},a.playAmbientSound=function(){pgc.Game.getAudioEngine().version>1?(pgc.Game.getAudioEngine().stopSound(j.main,j.ambient),j.main=pgc.Game.ScratchController.skinSelect(a.audio.names.main),j.ambient=pgc.Game.ScratchController.skinSelect(a.audio.names.ambience),a.readyWait(function(){return!c.sounds_[j.main].tracks[j.ambient].playing},function(){k=!0,f?pgc.Game.getAudioEngine().playLoopedSound(j.main,j.ambient):pgc.Game.getAudioEngine().playSound(j.main,j.ambient,function(){k=!1})},500)):(d=Date.now(),k||(e=window.setInterval(DOMUtil.bind(function(){var b=Date.now();b-d>2e4&&(j.main=pgc.Game.ScratchController.skinSelect(a.audio.names.main),j.ambient=pgc.Game.ScratchController.skinSelect(a.audio.names.ambience),pgc.Game.getAudioEngine().playSound(j.main,j.ambient,function(){k=!1}),d=b)},this),1e3),k=!0))},a.fadeAmbientSound=function(b){if(k){a.audio.fading||(a.audio.fading=!0,a.audio.timer=1e3*b,a.audio.lastTime=(new Date).getTime());var c=(new Date).getTime(),d=c-a.audio.lastTime;a.audio.timer=Math.max(0,a.audio.timer-d);var e=a.audio.timer/(1e3*b);a.getAudioEngine().setMasterVolume(e),e>0?requestAnimationFrame(function(){a.fadeAmbientSound(b)}):(a.audio.fading=!1,pgc.Game.getAudioEngine().stopAll(!1),a.getAudioEngine().setMasterVolume(1))}},a.startScratchSound=function(){var b=function(){return a.getAudioEngine().version>1?!1:l||q||r};return function(){p||b()||!a.isAudioAvailable()||(p=!0,pgc.Game.getAudioEngine().version>1&&n?(pgc.Game.getAudioEngine().resumeSound(pgc.Game.ScratchController.skinSelect(a.audio.names.main),pgc.Game.ScratchController.skinSelect(a.audio.names.scratching),"true"),n=!1):pgc.Game.getAudioEngine().playLoopedSound(pgc.Game.ScratchController.skinSelect(a.audio.names.main),pgc.Game.ScratchController.skinSelect(a.audio.names.scratching)),o=window.setInterval(a.stopScratchSound,50))}}(),a.stopScratchSound=function(b){p&&((Date.now()-m>250||b)&&(pgc.Game.getAudioEngine().version>1?(pgc.Game.getAudioEngine().pauseSound(pgc.Game.ScratchController.skinSelect(a.audio.names.main),pgc.Game.ScratchController.skinSelect(a.audio.names.scratching)),n=!0):pgc.Game.getAudioEngine().stopSound(pgc.Game.ScratchController.skinSelect(a.audio.names.main),pgc.Game.ScratchController.skinSelect(a.audio.names.scratching)),window.clearInterval(o),o=-1,p=!1),n=!0)},a.updateTimeSinceLastScratchEvent=function(){m=Date.now(),-1==o&&a.startScratchSound()},a.toggleSound=function(b){var d=c.isSoundOn();d=!d,c.toggleSound(d),pgc.Game.UserData.setUserData(gameName+"-audioEnabled",d),d?(DOMUtil.appendClassName(g,"","soundOff"),("InGame"===a.StateMachine.current||"Intro"===a.StateMachine.current)&&a.playAmbientSound()):(DOMUtil.appendClassName(g,"soundOff",""),c.stopAll(!1),l=!1,p=!1,q=!1,k=!1)},a.isAudioEngineDelayedLoad=function(){return i},a.setAudioEngineDelayedLoad=function(a){i=a},a.updateAmbientLastEventTime=function(){d=Date.now()},a.playMatchSound=function(){!l&&a.isAudioAvailable()&&(l=!0,pgc.Game.getAudioEngine().version<=1&&(p&&pgc.Game.stopScratchSound(!0),pgc.Game.getAudioEngine().stopAll(!1)),pgc.Game.getAudioEngine().playSound(pgc.Game.ScratchController.skinSelect(a.audio.names.main),pgc.Game.ScratchController.skinSelect(a.audio.names.match),function(){l=!1},!0,!0))},a.playInstantWinSound=function(){!q&&a.isAudioAvailable()&&(q=!0,pgc.Game.getAudioEngine().version<=1&&(p&&pgc.Game.stopScratchSound(!0),pgc.Game.getAudioEngine().stopAll(!1)),pgc.Game.getAudioEngine().playSound(pgc.Game.ScratchController.skinSelect(a.audio.names.main),pgc.Game.ScratchController.skinSelect(a.audio.names.instant),function(){q=!1},!0))},a.stopAllAndPlay=function(){return function(b,c){a.isAudioAvailable()&&(pgc.Game.getAudioEngine().stopAll(!1),pgc.Game.getAudioEngine().playSound(c?b:pgc.Game.ScratchController.skinSelect(a.audio.names.main),c||b,function(){},!0))}}(),a.playSoundWithBlockingScratchSound=function(){var b=!1;return function(c,d){!b&&a.isAudioAvailable()&&(b=!0,r=!0,pgc.Game.getAudioEngine().version<=1&&(p&&pgc.Game.stopScratchSound(!0),pgc.Game.getAudioEngine().stopAll(!1)),pgc.Game.getAudioEngine().playSound(d?c:pgc.Game.ScratchController.skinSelect(a.audio.names.main),d||c,function(){b=!1,r=!1},!0))}}(),a.isAudioAvailable=function(){return c.getAudioSprite(pgc.Game.ScratchController.skinSelect(a.audio.names.main))&&c.getAudioSprite(pgc.Game.ScratchController.skinSelect(a.audio.names.main)).ready&&c.isSoundOn()},a.preloadAudioMobileFallback=function(){pgc.Game.getAudioEngine().getAudioSprite(pgc.Game.ScratchController.skinSelect(a.audio.names.main)).audioScrollEvent(null,null,function(){}),pgc.Game.setAudioEngineDelayedLoad(!1)},a.scratchSceneReferences=[],a.symbolGroupReferences=[],function(b){var c=new Date,d=null,e=b.$(document.body),f=!1,g="Idling",h=function(a){c=new Date,a>0&&c.setMilliseconds(a),f=!1},i=function(){e.addClass(g)},j=function(){e.removeClass(g)},k=s,l=function o(){var b=a.idleTimeLimit||5e3,e=new Date-c;e>b&&(f?a.trigger("repeatedidle",e-b):(f=!0,a.trigger("idle"),a.trigger("repeatedidle",0),i())),d=setTimeout(o,k)},m=function(){clearTimeout(d),d=null},n=function(){f&&a.trigger("idlefinish")};a.idleManager={listen:function(){d||(h(),l())},stop:function(){this.reset(),m()},reset:function(a){n(),h(a),j()}}}(b),function(b){var c=new Date,d=null,e=function(a){c=new Date,a>0&&c.setMilliseconds(a)},f=500,g=function i(){var b=new Date-c,g=window.touchCasinoBrandConf&&window.touchCasinoBrandConf.timeBetweenHeartbeats||6e4;b>g&&(a.Client.sendHeartbeatMessage(),a.trigger("heartbeat"),e()),d=setTimeout(i,f)},h=function(){clearTimeout(d),d=null};a.heartbeatManager={start:function(){d||(e(),g())},stop:function(){this.reset(),h()},reset:function(a){e(a)}}}(b),function(b){a.applyOldSelectionFlow=function(){b.$(document.body).addClass("OldSelectionFlow"),a.oldSelectionFlow=!0},a.isOldSelectionFlow=function(){return!!a.oldSelectionFlow},a.hasSelectionScene=function(){return"default"===userAgent.OS&&!a.isOldSelectionFlow()}}(b),pgc.Game=a}(pgc.Game||{},PGCUniverse.PGCToolkit);